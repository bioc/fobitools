---
title: "Dietary text annotation"
author: 
- name: Pol Castellano-Escuder
  affiliation: University of Barcelona, Spain.
  email: polcaes@gmail.com
date: "`r BiocStyle::doc_date()`"
output: 
    BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{Dietary text annotation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{tidyverse, kableExtra}
bibliography: ["fobitools.bib"]
biblio-style: apalike
link-citations: true
---

**Compiled date**: `r Sys.Date()`

**Last edited**: 2021-10-05

**License**: `r packageDescription("fobitools")[["License"]]`

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Installation

Run the following code to install the Bioconductor version of the package.        

```{r, eval = FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("fobitools")
```

# Load packages 

```{r, warning = FALSE, message = FALSE, comment = FALSE}
library(fobitools)
```

We will also need some additional [CRAN](https://cran.r-project.org) packages that will be very useful in this vignette.

```{r, warning = FALSE, message = FALSE, comment = FALSE}
library(tidyverse)
library(kableExtra)
```

# Load food items from a food frequency questionnaire (FFQ) sample data 

In nutritional studies, dietary data are usually collected by using different questionnaires such as FFQs (food frequency questionnaires) or 24h-DRs (24 hours dietary recall). Commonly, the text collected in these questionnaires require a manual preprocessing step before being analyzed.        

This is an example of how an FFQ could look like in a common nutritional study.     

```{r, warning = FALSE, message = FALSE, comment = FALSE}
load("data/sample_ffq.rda")

sample_ffq %>%
  dplyr::slice(1L:10L) %>%
  kbl(row.names = FALSE, booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped"))
```

<!-- CONTENT -->

# Session Information

```{r}
sessionInfo()
```

# References

<!-- END -->


# Automatic anotation with `fobitools::annotate_foods()`

The `annotate_foods` function allows the automatic annotation of free nutritional text using the FOBI ontology. This function returns a table with the IDs and names of the FOBI terms that match the input text.       

The `annotate_foods` function provides a text mining algorithm composed of 5 sequential layers. In this process, singulars and plurals are analyzed, irrelevant words are removed, each string of the text input is tokenized and each word is analyzed independently, and the semantic similarity between input text and FOBI's text is computed. Finally, along with the table the function also returns the percentage of the annotated input text.     

```{r, warning = FALSE}
# annotated_text <- fobitools::annotate_foods(free_text)
```

```{r, warning = FALSE, message = FALSE, comment = FALSE, echo = FALSE}
# kbl(annotated_text$annotated, 
#     row.names = FALSE,
#     booktabs = TRUE) %>%
#   kable_styling(latex_options = c("striped"))
```

# Network visualization of the annotated terms

Then, with the `fobi_graph` function we can visualize the annotated terms with their corresponding FOBI relationships.        

```{r, warning = FALSE, message = FALSE, comment = FALSE, fig.align = "center", fig.height = 8, fig.width = 10}
# terms <- annotated_text$annotated %>% 
#   pull(FOBI_ID)
# 
# # create the associated graph
# fobitools::fobi_graph(terms = terms, 
#                       get = "anc",
#                       labels = TRUE,
#                       legend = TRUE)
```

